\documentclass[12pt]{article}
% \usepackage[utf8]{inputenc}
% \usepackage[T1]{fontenc}
%% \usepackage{lmodern}
\usepackage{graphicx}
\usepackage[small]{caption}
\usepackage{amsmath, amssymb}
\usepackage{fullpage}
\newcommand{\R}{\mathbb{R}}
\newcommand{\Z}{\mathbb{Z}}
% helper macro for vectors
\newcommand{\vb}[1]{\ensuremath{\mathbf{#1}}}

\newtheorem{theorem}{Theorem}
\newtheorem{definition}{Definition}

\begin{document}
\author{Antoine Levitt}
\title{Finite volumes method for incompressible Navier-Stokes equations}
\maketitle
\abstract{TODO}
\tableofcontents
\newpage

\section{Introduction}
TODO
\section{Physical context}
We study a fluid contained in a d-dimensional (d = 2 or 3) domain
$\Omega$, with a boundary $\partial \Omega$. Positions are specified
by the d-dimensional vector \vb{x}. For every time $t \in \R^+$, the
fluid is described by its velocity $\vb{v}(\vb{x}, t)$, its density
$\rho(\vb{x}, t)$, its pressure $p(\vb{x},t)$ and its temperature
$T(\vb{x}, t)$. The model used are the Navier-Stokes equations in the
Boussinesq approximation, which lead to coupled partial differential
equations (PDEs) for these variables. Together with initial and
boundary condition, they specify the evolution of the flow.
\subsection{The Navier-Stokes equations}
The Navier-Stokes equations are a reformulation of conservation of
momentum (Newton's Second Law) and conservation of mass in the case of
a fluid. The conservation of momentum equation reads
\begin{equation}
  \label{ns-mom}
  \rho \left(\frac{\partial \mathbf{v}}{\partial t} + \mathbf{v} \cdot
    \nabla \mathbf{v}\right) = -\nabla p + \nabla \cdot\mathbb{T} +
  \mathbf{f}.
\end{equation}
$\mathbb{T}$ is the stress tensor, and \vb{f} are the external volumic
forces exerting on the fluid (gravity, electromagnetic ...).  We need
an expression of $\mathbb{T}$ as a function of the other variables for
the model to be complete. The second term, $\mathbf{v} \cdot \nabla
\mathbf{v}$, known as the convective acceleration, is to be understood
as $(\vb{v} \cdot \nabla) \vb{v}$, that is, the ``transport operator''
$(\vb{v} \cdot \nabla) = \sum_{i=1}^d v_i \frac{\partial}{\partial i}$
applied to $\vb{v}$.

The conservation of mass equation is
\begin{equation}
  \label{ns-mass}
  \frac{\partial \rho}{\partial t} + \nabla \cdot (\rho \mathbf{v}) = 0.
\end{equation}

These equations can be derived by applying conservation laws to an
infinitesimal volume of fluid.
\subsection{Natural convection and Boussinesq approximation}
We are now interested in studying natural convection. While in forced
convection the fluid flow is imposed (by boundary conditions either in
velocity or pressure), in natural convection the fluid is set in
motion by temperature gradients alone.  These temperature gradients
cause density inhomogeneities, which in turn affect the gravity forces
$- \rho g \vb{e_z}$ and cause relative motion of the fluid. The
Boussinesq approximation is the simplest model that still allows
natural convection : we neglect the effects of density inhomogeneities
everywhere in the Navier-Stokes equations, except in the gravity
forces. We also neglect the variation of other physical parameters
(viscosity, diffusivity, etc.).

The only external force here is gravity, so $\vb{f} = -\rho g
\vb{e_z}$. $\rho$ depends on the temperature $T$ by a state equation
(for instance, ideal gas law). At the first order, we can write $\rho
- \rho_0 = - \alpha \delta T$, where $\delta T$ is the difference
between the actual temperature and a reference state, and $\alpha > 0$
is a coefficient depending on the fluid. This leads to $\vb{f} =
(-\rho_0 + \alpha \delta T) g \vb{e_z}$ : this confirms the
experimental observation that hot air rises and cold air falls.

Assuming $\rho$ to be constant in the other terms simplifies greatly
the equations. The mass equation becomes the equation of an
incompressible flow
\begin{equation}
  \label{ns-b-mass}
  \nabla \vb{v} = 0.
\end{equation}

We also assume the fluid to be Newtonian (which is the case of most
fluids commonly encountered, including the object of our study,
air). Together with incompressibility, this implies that $\nabla \cdot
\mathbb T = \mu \Delta \vb{v}$, where $\mu$ is the kinematic viscosity
of the flow, assumed to be constant.

To simplify notations, we use the variable change $p = p + \rho_0 g z$
($p$ is now the difference between the actual pressure and the
hydrostatic pressure), and $T = \delta T$ ($T$ is the difference in
temperature to the reference state). The momentum equation now
becomes :
\begin{equation}
  \label{ns-mom}
  \rho \left(\frac{\partial \mathbf{v}}{\partial t} + \mathbf{v} \cdot
    \nabla \mathbf{v}\right) = -\nabla p + \mu \Delta \vb{v} + \alpha g
  T \vb{e_z}.
\end{equation}

The evolution of the temperature $T$ is described by energy
conservation, which, under our hypotheses, is
\begin{equation}
  C_p \rho \left(\frac{\partial T}{\partial t} + \vb{v} \cdot \nabla T\right) = k \Delta T.
\end{equation}

This is a generalisation of the heat equation in the case of a moving
medium. Note that since $\nabla \cdot \vb{v} = 0$, our variable change
$T = \delta T$ has no effect on this equation.

Finally, we adimensionalise the equations by introducing Rayleigh and
Prandtl numbers $Ra$ and $Pr$, which reduces the number of parameters
to only two. The final form of our equations is then
\begin{align}
  \label{b-mass}
  \nabla \cdot \vb{v} &= 0& \text{Mass}\\
  \label{b-mom}
  \frac{\partial \mathbf{v}}{\partial t} + \mathbf{v} \cdot
  \nabla \mathbf{v} +\nabla p - Pr \Delta \vb{v} - Ra Pr T
  \vb{e_z} &= 0& \text{Momentum}\\
  \label{b-ene}
  \frac{\partial T}{\partial t} + \vb{v} \cdot \nabla T - \Delta
  T&=0& \text{Energy}
\end{align}

This is a system of $d + 2$ coupled PDEs with $d+2$ variables
($\vb{v}$, $p$ and $T$). The two parameters $Ra$ and $Pr$ quantify the
relative effect of viscosity and buoyancy.

\section{Finite volumes}
We consider the steady equations ($\frac{\partial \vb{v}}{\partial t}
= \frac{\partial T}{\partial t} = 0$) in the model described above. We
prescribe boundary conditions on $\partial \Omega$. Finite volumes are
a way to approximate solutions of the PDEs, by computing their values
on elements of a mesh : we assume the domain $\Omega$ to be subdivised
in elements $K \in \mathcal{M}_\Omega$, called control volumes.

In this section, boundary conditions are taken to be homogeneous
Dirichlet conditions to simplify the presentation. Other boundary
conditions (non-homogeneous Dirichlet conditions, Neumann conditions)
may still be expressed using the same basic principles.
\subsection{Theory}
We first integrate the equations
(\ref{b-mass}-\ref{b-mom}-\ref{b-ene}) over each control volume
$K$. Then we apply Green formulae to convert the $d$-dimensional
integrals over $K$ into $d-1$ integrals over the boundary $\partial K$
of each control volume :

Eqs ici

Note that this is only a reformulation, and no discretisation was
done. Solutions of this problem are solutions of the original problem,
and vice versa. The discretisation step consists in keeping only the
values of the variables at element centers $\vb{x}_K$, and
interpolating the integrals (fluxes) with these values. This leads to
a nonlinear system of algebraic equations, which can be solved by
Newton type method.

The difference with the classical finite differences method is that
the discretisation is performed on fluxes rather than on differential
operators. This is simpler because one differentiation order is lost :
Laplacians become gradients integrals. Another advantage is that the
finite volume method is much more easily generalized to various sorts
of meshs, and not limited to rectangular ones.

This method can also be seen as a finite element method, where the
test functions $v$ are chosen in the space of piecewise constant
functions over the mesh. This is not a subspace of the space in which
the solution is searched, since piecewise constant functions have no
gradient : it is a non-conforming finite element method. One advantage
of this method over finite element methods is that equations
(\ref{TODO}) have an obvious physical meaning : they express
conservation laws on a control volume $K$.

Our problem is now to choose suitable interpolation methods for the
integrals
\subsection{Implementation}
At the core of the algorithm is the solution of a nonlinear system of
size equal to the number of cells. We use the standard Newton
algorithm : we linearize the problem around an iterate $x_n$, solve
this linear problem to obtain $x_{n+1}$, and repeat until
convergence. Denoting by $x$ the unknowns of our problem, i.e. the
velocities, pressures and temperatures at the cell centers, by $f(x)$
the left-hand side of (\ref{TODO}), and by $J_f(x)$ the Jacobian
matrix of $f$ at point $x$, the iteration is given by
\begin{equation}
  \label{eq:newton}
  J_f(x_n) (x_{n+1} - x_n) = - f(x_n)
\end{equation}
The Jacobian is obtained by differentiating equation (\ref{TODO}). The
result is a linear system, wich is solved for $x_{n+1}$. The iteration
is carried out until convergence. We stop the iterations when both the
increment $||x_{n} - x_{n-1}||_\infty$ and the residual
$||f(x_n)||_\infty$ are lower than $\varepsilon =
10^{-10}$. Convergence can be seen in
Fig. \ref{fig:conv_newton}. After a transient, we observe the
characteristic quadratic convergence of Newton method, and convergence
is quickly achieved.
\begin{figure}[htb]
\centering
\includegraphics{figs/convergence}
\caption{Convergence of Newton method}
\label{fig:conv_newton}
\end{figure}
\subsubsection{Solving the linear system}
Solution of linear systems is of order $\mathcal O (n^3)$. This, as
well as the memory cost of keeping $n^2$ entries, is prohibitively
large for our problems, where $n$ can be around $100\,000$. However,
because of the locality of the fluxes approximations, the value of
$f(x_n)$ on cell $i$ depends only of the value of $x_n$ on cells
connected to cell $i$ : the number of non-zero elements of the
Jacobian is of order $\mathcal O (n)$. This kind of matrices are known
as sparse matrices, and the use of appropriate data structures to
store them yields huge savings in memory and computation time.

We use a modified version of the conjugate gradient method, with a
preconditioning based on an incomplete LU factorisation. For some
ill-conditioned problems, this iterative algorithm may not converge
fast enough : we then fall back to a direct method, which is slower
and less precise but has no convergence issues.

\subsubsection{Convergence criterion}

\subsubsection{Under-relaxation}
For some problems, Newton method may oscillate around the solution. An
easy solution for this is to limit the amplitude of steps taken :
instead of $x_{n+1} = x_n + \Delta x$, we use $x_{n+1} = x_n +\theta
\Delta x$, where $\theta < 1$ is the under-relaxation factor. This
prevents oscillations but may lead to slower convergence. A sensible
choice is to limit the magnitude of the steps to be no greater than a
prescribed $\delta$ : if $||\Delta x|| > \delta$, $\theta = \delta /
||\Delta x||$, and if not, $\theta = 1$.
\section{The chimney problem}
\section{Numerical experiments}
\subsection{Methodology}
\subsection{Results}
\begin{table}[!h]
  \centering
  \begin{tabular}{|l|c|c|}
    \hline
    & Local (stationary \& instationary) & Global (instationary) \\
    \hline
    Pression benchmark & 73.23 & 85.51\\
    Pression lequere & 59.08 & 76.98\\
    \hline
  \end{tabular}
  \caption{Mass flux for different boundary conditions}
\end{table}
\section{Conclusion}
TODO
\listoffigures
\listoftables

\begin{thebibliography}{99}
\end{thebibliography}
\end{document}
